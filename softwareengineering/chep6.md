# 第6章 详细设计

`根本目标`：确定应该怎样 `具体` 地实现所要求的系统。

详细设计阶段的任务不是具体地编写程序，而是要 `设计出程序的“蓝图”`。

详细设计的结果基本上决定了最终的程序代码的质量。

详细设计

1. 确定软件各个组成部分内的算法以及各部分的内部数据组织；
2. 选定某种过程的表达形式来描述各种算法；
3. 进行详细设计的评审；

数据设计原则  

1. 为在需求分析阶段所确定的数据对象选择逻辑表示，需要对不同结构进行算法分析，以便选择一个最有效的结构；设计对于这种逻辑数据结构的一组操作，以实现各种所期望的运算。
2. 确定对逻辑数据结构所必需的那些操作的程序模块(软件包)，以便限制或确定各个数据设计决策的影响范围。

数据设计过程

1. 用于软件的系统化方法也适用于数据。
2. 确定所有的数据结构和在每种数据结构上施加的操作。
3. 应当建立一个数据词典并用它来定义数据和软件的设计。
4. 低层数据设计的决策应推迟到设计过程的后期进行。
5. 数据结构的表示只限于那些必须直接使用该数据结构内数据的模块才能知道。
6. 应当建立一个存放有效数据结构及相关操作的库。
7. 软件设计和程序设计语言应当支持抽象数据类型的定义和实现。

## 6.1 结构程序设计

1965年结构程序设计的概念最早由E.W.Dijkstra提出：程序的质量与程序中所包含的GO TO 语句的数量成反比。

1966年Bohm和Jacopini证明了只用`“顺序”`、`“选择”`和`“循环”`控制结构就能实现任何单入口单出口的程序。

![img 6.1](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589338041/notepad/2020-05-13_101531_arbhpe.webp)

实际上用 `顺序结构` 和 `循环结构`（又称DO-WHILE结构）完全可以实现选择结构（又称IF-THEN-ELSE结构），因此，理论上最基本的控制结构只有 `两` 种。

- 1968年Dijkstra再次建议从一切高级语言中取消GO TO语句，只使用3种基本控制结构写程序。学界认识到不是简单地去掉GO TO 语句的问题，而是要创立一种新的程序设计思想、方法和风格。
- 1971年IBM公司在纽约时报信息库管理系统的设计中成功地使用了结构程序设计技术
- 1972年IBM公司的Mills进一步提出，程序应该 `只有一个入口和一个出口`，补充了结构程序设计的规则。

结构程序设计经典定义：如果一个程序的代码块仅仅通过顺序、选择和循环这3种基本控制结构进行连接，并且每个代码块只有一个入口和一个出口，则称这个程序是 `结构化` 的。

结构程序设计更全面的定义：结构程序设计是尽可能少用GO TO语句的程序设计方法。最好仅在检测出错误时才使用GO TO语句，而且应该总是使用前向GO TO语句。

从理论上说只用上述3种基本控制结构就可以实现任何单入口单出口的程序，但是为了实际使用方便起见，常常还允许使用 `DO-UNTIL` 和 `DO-CASE` 两种控制结构

![img 6.1 - 2](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589338041/notepad/2020-05-13_101659_hcr5zj.webp)

如果只允许使用顺序、IF-THEN-ELSE型分支和DO-WHILE型循环这3种基本控制结构，则称为 `经典的结构程序设计`；

如果除了上述3种基本控制结构之外，还允许使用DO-CASE型多分支结构和DO-UNTIL型循环结构，则称为 `扩展的结构程序设计`；

如果再允许使用LEAVE（或BREAK ）结构，则称为 `修正的结构程序设计`。

## 6.2 人机界面设计

### 6.2.1 设计问题

1. 系统响应时间。
2. 用户帮助设施。
3. 出错信息处理。
4. 命令交互。

#### 系统响应时间

系统响应时间指从用户完成某个控制动作（例如，按回车键或单击鼠标），到软件给出预期的响应（输出信息或做动作）之间的这段时间。

系统响应时间有两个重要属性，分别是 `长度` 和 `易变性`。

- (1) 长度：时间过长，用户就会感到紧张，过短，加快用户操作节奏，可能会犯错误。
- (2) 易变性：系统响应时间相对于平均响应时间的偏差即使系统响应时间较长，响应时间易变性低也有助于用户建立起稳定的工作节奏。

#### 用户帮助设施

常见的帮助设施可分为 `集成的` 和 `附加的` 两类。

- 在用户与系统交互期间，是否在任何时候都能获得关于系统任何功能的帮助信息？有两种选择：提供部分功能的帮助信息和提供全部功能的帮助信息。
- 用户怎样请求帮助？有3种选择：`帮助菜单`，`特殊功能键` 和 `HELP命令`。
- 怎样显示帮助信息？有3种选择：在独立的窗口中，指出参考某个文档（不理想）和在屏幕固定位置显示简短提示。
- 用户怎样返回到正常的交互方式中？有两种选择：屏幕上的返回按钮和功能键。
- 怎样组织帮助信息？有3种选择：`平面结构`，`信息的层次结构` 和 `超文本结构`。

#### 出错信息处理

出错信息和警告信息，是出现问题时交互式系统给出的“坏消息”。一般说来，交互式系统给出的出错信息或警告信息，具有下述属性。

- (1) 用用户可以理解的术语描述问题。
- (2) 提供有助于从错误中恢复的建设性意见。
- (3) 指出错误可能导致哪些负面后果（例如，破坏数据文件），以便用户检查是否出现了这些问题，并在确实出现问题时及时解决。
- (4) 伴随着听觉上或视觉上的提示
- (5) 不能带有指责色彩，不能责怪用户。

#### 命令交互

许多高级用户仍然偏爱面向 `命令行` 的交互方式
在提供命令交互方式时，必须考虑下列设计问题。

- (1) 是否每个菜单选项都有对应的命令？
- (2) 采用何种命令形式？有3种选择：`控制序列`（例如，Ctrl+P），`功能键` 和 `输入命令`。
- (3) 学习和记忆命令的难度有多大？忘记了命令怎么办？
- (4) 用户是否可以定制或缩写命令？

在越来越多的应用软件中，人机界面设计者都提供了`“命令宏机制”`。在理想的情况下，所有应用软件都有一致的命令使用方法。

### 6.2.2 设计过程

用户界面设计是一个 `迭代` 的过程，通常先创建设计模型，再用原型实现这个设计模型，并由用户试用和评估，然后根据用户意见进行修改。

建立起用户界面的原型，就必须对它进行评估，评估可以是非正式的也可以使正式的。

![img 6.2.2](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589338041/notepad/2020-05-13_102314_iyhxfo.webp)

创建了用户界面的设计模型之后，可以运用下述评估标准对设计进行早期复审。

- (1) 系统及其界面的规格说明书的长度和复杂程度，预示了用户学习使用该系统所需要的 `工作量`。
- (2) 命令或动作的数量、命令的平均参数个数或动作中单个操作的个数，预示了系统的 `交互时间` 和 `总体效率`。
- (3) 设计模型中包含的动作、命令和系统状态的数量，预示了用户学习使用该系统时需要 `记忆的内容的多少`。
- (4) 界面风格、帮助设施和出错处理协议，预示了界面的 `复杂程度` 及用户 `接受该界面的程度`。

### 6.2.3 人机界面设计指南

#### 一般交互指南

涉及信息显示、数据输入和系统整体控制

- 保持一致性。
- 提供有意义的反馈。
- 在执行有较大破坏性的动作之前要求用户确认。
- 允许取消绝大多数操作。
- 减少在两次操作之间必须记忆的信息量。
- 提高对话、移动和思考的效率。
- 允许犯错误。
- 按功能对动作分类，并据此设计屏幕布局。
- 提供对用户工作内容敏感的帮助设施
- 用简单动词或动词短语作为命令名。

#### 信息显示指南

多种不同方式“显示”信息，用文字、图形和声音；按位置、移动和大小；使用颜色、分辨率和省略。

- 只显示与当前工作内容有关的信息。
- 不要用数据淹没用户，应该用便于用户迅速吸取信息的方式来表示数据。
- 使用一致的标记、标准的缩写和可预知的颜色。
- 允许用户保持可视化的语境。
- 产生有意义的出错信息。
- 使用大小写、缩进和文本分组以帮助理解。
- 使用窗口分隔不同类型的信息。
- 使用“模拟”显示方式表示信息，以使信息更易被用户提取。
- 高效率地使用显示屏。

#### 数据输入指南

用户的大部分时间用在选择命令、输入数据和向系统提供输入。

- 尽量减少用户的输入动作。
- 保持信息显示和数据输入之间的一致性。
- 允许用户自定义输入。
- 交互应该是灵活的，并且可调整成用户最喜欢的输入方式。
- 使在当前动作语境中不适用的命令不起作用。
- 让用户控制交互流。
- 对所有输入动作都提供帮助。
- 消除冗余的输入。
- 高效率地使用显示屏。

## 6.3 过程设计的工具

数据设计工具  

- 图形工具（程序流程图、N-S图、问题分析图，PAD） ；
- 表格工具（判定表 ）；
- 语言工具（Progress Design Language，PDL）

程序流程图

![img 6.3](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589338041/notepad/2020-05-13_103106_qob0be.webp)

### 6.3.1 程序流程图

`程序流程图` 又称为 **程序框图**，它是使用最广泛的描述过程设计的方法。

![img 6.3.1](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589338041/notepad/2020-05-13_103156_zzjzqm.webp)

程序流程图中使用的符号(a) 选择（分支）； (b) 注释； (c) 预先定义的处理； (d) 多分支； (e) 开始或停止； (f) 准备； (g) 循环上界限； (h) 循环下界限； (i) 虚线； (j) 省略符； (k) 并行方式； (l) 处理； (m) 输入输出；  (n) 连接； (o) 换页连接； (p) 控制流

总的趋势是越来越多的人不再使用程序流程图了。

程序流程图的主要缺点如下。

- (1) `程序流程图本质上不是逐步求精的好工具`，它诱使程序员过早地考虑程序的控制流程，而不去考虑程序的全局结构。
- (2) `程序流程图中用箭头代表控制流，因此程序员不受任何约束`，可以完全不顾结构程序设计的精神，随意转移控制。
- (3) `程序流程图不易表示数据结构`。

### 6.3.2 盒图

出于要有一种不允许违背结构程序设计精神的图形工具的考虑，Nassi和Shneiderman提出了 `盒图`，又称为 `N-S图`。它有下述特点。

- (1) 功能域（即一个特定控制结构的作用域）明确，可以从盒图上一眼就看出来。
- (2) 不可能任意转移控制。
- (3) 很容易确定局部和全程数据的作用域。
- (4) 很容易表现嵌套关系，也可以表示模块的层次结构。

图给出了结构化控制结构的盒图表示，也给出了调用子程序的盒图表示方法。其中：

![img 6.3.2](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589338042/notepad/2020-05-13_103428_nhtyvn.webp)

基本符号(a) 顺序； (b) IF_THEN_ELSE型分支； (c) CASE型多分支； (d) 循环； (e) 调用子程序A


### 6.3.3 PAD图

`PAD` 是 `问题分析图`（ problem analysis diagram ）的英文缩写，用二维树形结构的图来表示程序的控制流。

![img 6.3.3](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589338040/notepad/2020-05-13_103541_i97bik.webp)

- (a) 顺序（先执行P1后执行P2 ）；
- (b) 选择（ IF C THEN P1 ELSE P2）；
- (c) CASE型多分支；
- (d) WHILE型循环（WHILE C DO P ）；
- (e) UNTIL型循环（ REPEAT P UNTIL C ）；
- (f) 语句标号；
- (g) 定义

PAD图的主要优点如下：

- (1) 使用表示 `结构化控制结构` 的PAD符号所设计出来的程序必然是 `结构化程序`。
- (2) PAD图所描绘的程序结构十分清晰。
- (3) 用PAD图表现程序逻辑，易读、易懂、易记。
- (4) 容易将PAD图转换成高级语言源程序，这种转换可用 `软件工具自动完成`，从而可省去人工编码的工作，有利于提高软件可靠性和软件生产率。
- (5) 可用于表示 `程序逻辑`，也可用于描绘 `数据结构`。
- (6) PAD图的符号支持 `自顶向下`、`逐步求精` 方法的使用。

![img 6.3.3 - 2](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589338040/notepad/2020-05-13_103710_hiqmfa.webp)

(a) 初始的PAD图； (b) 使用def符号细化处理框P2

### 6.3.4 判定表

`判定表`能够清晰地表示复杂的条件组合与应做的动作之间的对应关系。

判定表由 `4` 部分组成，

- 左上部列出所有 `条件`
- 左下部是所有可能做的 `动作`
- 右上部是表示各种条件组合的一个 `矩阵`
- 右下部是和每种条件组合相对应的 `动作`。

判定表右半部的每一列实质上是一条 `规则`，规定了与特定的条件组合相对应的动作。

判定表用于表示程序的 `静态逻辑`

在判定表中的条件部分给出所有的 `两分支判断` 的列表，动作部分给出 `相应的处理`

要求将程序流程图中的多分支判断都改成两分支判断

![img 6.3.4](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589338040/notepad/2020-05-13_103942_kyzon1.webp)

对应流程图的判定表

![img 6.3.4 - 2](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589338041/notepad/2020-05-13_104012_jvnbcs.webp)

![img 6.3.4 - 3](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589338330/notepad/2020-05-13_104101_amhrms.webp)

### 6.3.5 判定树

`判定树` 是判定表的变种，它也能清晰地表示复杂的条件组合与应做的动作之间的对应关系。

![img 6.3.5](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589338330/notepad/2020-05-13_104153_kev9sh.webp)

### 6.3.6 过程设计语言

`过程设计语言（PDL）` 也称为 `伪码`。是用 `正文形式` 表示数据和处理过程的设计工具。

PDL有下述特点：

- (1) 关键字的固定语法，它提供了结构化控制结构、数据说明和模块化的特点。如，if…fi（或endif ）等
- (2) 自然语言的自由语法，它描述处理特点。
- (3) 数据说明的手段。应该既包括简单的数据结构（例如纯量和数组），又包括复杂的数据结构（例如，链表或层次的数据结构）。
- (4) 模块定义和调用的技术，应该提供各种接口描述模式。

#### PDL语言

1. PDL是一种用于描述功能模块的 `算法设计` 和 `加工细节` 的语言。称为设计程序用语言。它是一种伪码。
2. 伪码的语法规则分为“外语法”和“内语法”。
3. PDL具有严格的 `关键字外语法`，用于定义控制结构和数据结构，同时它的 `表示实际操作和条件的内语法` 又是灵活自由的，可使用自然语言的词汇。

示例: 拼词检查程序

```plain
PROCEDURE  spellcheck  IS
BEGIN
  split document into single  words
  lood up words in dictionary
  display words which are not in dictionary create a new dictionary
END spellcheck

```

PDL有下述优点：

- 可以作为注释直接插在源程序中间。
- 可以使用普通的正文编辑程序或文字处理系统，很方便地完成PDL的书写和编辑工作。
- 已经有 `自动处理PDL的程序` 存在，而且可以自动由PDL生成程序代码。

PDL的缺点是不如图形工具形象直观，描述复杂的条件组合与动作间的对应关系时，不如判定表清晰简单。

## 6.4 面向数据结构的设计方法

### 6.4.1 Jackson图

![img 6.4.1](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589339301/notepad/2020-05-13_105354_oxgbxa.webp)

### 6.4.2 改进的Jackson图

![img 6.4.2](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589339301/notepad/2020-05-13_105512_hpjd08.webp)

- 顺序结构，B、C、D中任一个都不能是选择出现或重复出现的数据元素（即不能是右上角有小圆圈或星号标记的元素）；
- 选择结构，S右面括号中的 `数字i` 是分支条件的编号；
- 可选结构，A或者是元素B或者不出现；
- 重复结构，`循环结束条件的编号为i`。

#### Jackson图特点

- 便于表示层次结构,而且是对结构进行自顶向下分解的有力工具;
- 形象直观可读性好
- 既能表示数据结构也能表示程序结构

#### Jackson图与数据流图和层次框图之间的区别

- 数据流图是根据数据确定软件结构的方法,主要应用于需求分析和概要设计阶段
- Jackson图是根据数据结构设计程序处理过程的方法
- 层次框图与Jackson图虽然类似,但其中图形元素的含义不同,层次图主要用于描述模块及其之间的关系.但Jackson图描述的是程序结构.

#### Jackson方法的基本步骤

- 分析并确定输入数据和输出数据的逻辑结构,并使用Jackson图描绘这些数据结构
- 找出输入数据结构和输出数据结构有对应关系的数据单元(即程序中可以同时处理的数据单元)
- 依据规则导出Jackson图
- 列出所有操作和条件,并把他们分配到程序结构图的适当位置
- 用伪码表示程序

#### 导出Jackson图的规则

- 为每对有对应关系的数据单元,按照它们在数据结构图中的层次在程序结构图的相应层次画一个处理框
- 根据输入数据结构中剩余的每个数据单元所处的层次,在程序结构图的相应层次分别为它们画上对应的处理框
- 根据输出数据结构中剩余的每个数据单元所处的层次,在程序结构图的相应层次分别为它们画上对应的处理框

#### Jackson图的实例

下面结合一个具体例子进一步说明Jackson结构程序设计方法。

例：一个 `正文文件` 由若干个 `记录` 组成，每个记录是一个 `字符串`。要求统计每个记录中 `空格字符的个数`，以及文件中空格字符的总个数。要求的输出数据格式是，`每复制一行输入字符串之后，另起一行印出这个字符串中的空格数`，最后印出文件中空格的总个数。

第一步:描绘输入输出数据结构

![img 6.4.2 - 2](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589339300/notepad/2020-05-13_105953_lchvp8.webp)

第二步:分析对应关系的数据单元

![img 6.4.2 - 2](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589339300/notepad/2020-05-13_110048_k08sda.webp)

第三步:数据结构图导出程序结构图

![img 6.4.2 - 3](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589339300/notepad/2020-05-13_110136_m0dakq.webp)

第四步:列出所有操作和条件,并分配它们到程序结构图

- (1)停止
- (2)打开文件
- (3)关闭文件
- (4)印出字符串
- (5)印出空格数目
- (6)印出空格数目
- (7)sum:=sum+1
- (8)total:=totalsum+sum
- (9)读入字符串
- (10)sum:=0
- (11)totalsum:=0
- (12)pointer:=1
- (13)pointer:=pointer+1
- I(1)文件结束
- I(2)字符串结束
- S(3)字符是空格

![img 6.4.2 - 4](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589339300/notepad/2020-05-13_110410_rmzofr.webp)

第五步:使用伪码表示程序处理过程

```plain
统计空格seq
  打开文件
  读入字符串
  totalsum:=0
  程序体iter until 文件结束
    处理字符串seq
  印字符串 end
….
统计空格end
```

## 6.5 程序复杂程度的定量度量

定量度量程序复杂程度的方法很有价值：

- 把 `程序的复杂程度` 乘以适当常数即可估算出软件中 `错误的数量` 以及软件开发需要用的 `工作量`；
- 定量度量的结果可以用来比较两个不同的设计或两个不同算法的优劣；
- 程序的定量的复杂程度可以作为 `模块规模` 的精确限度。

### 6.5.1 McCabe方法

#### 1. 流图

McCabe方法根据程序控制流的复杂程度定量度量程序的复杂程度，这样度量出的结果称为程序的环形复杂度。

`流图实质上是“退化了的”程序流程图`，描绘程序的控制流程，`不表现对数据的具体操作以及分支或循环的具体条件`。

![img 6.5.1](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589339300/notepad/2020-05-13_110717_rs0vbo.webp)

- 一个圆代表一条或多条语句；
- 一个顺序结构可以合并一个结点；
- 流图中的箭头线称为边，代表控制流；
- 在流图中一条边必须终止于一个结点。

由PDL翻译成的流图

![img 6.5.1 - 2](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589339642/notepad/2020-05-13_111232_f7s3bt.webp)

![img 6.5.1 - 3](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589339642/notepad/2020-05-13_111322_wwoubf.webp)

复合条件，就是在条件中包含了一个或多个布尔运算符（逻辑OR,AND,NAND,NOR）

#### 2. 计算环形复杂度的方法

- (1) 流图中线性无关的区域数等于环形复杂度。
- (2) 流图G的环形复杂度 `V(G)=E-N+2`，其中，E是流图中边的条数，N是结点数。
- (3) 流图G的环形复杂度 `V(G)=P+1`，其中，P是流图中判定结点的数目。

上述流图的环形复杂度为4。

#### 3. 环形复杂度的用途

对测试难度的一种定量度量，也能对软件最终的可靠性给出某种预测。实践表明，模块规模以 `V(G)≤10` 为宜。

### 6.5.2 Halstead方法

根据程序中运算符和操作数的总数来度量程序的复杂程度。
令N1为程序中 `运算符` 出现的总次数，N2为 `操作数` 出现的总次数，程序长度N定义为：

- ```N=N1+N2```

程序中使用的不同运算符（包括关键字）的个数n1，以及不同操作数（变量和常数）的个数n2。Halstead给出预测程序长度的公式如下：

- ```H=n1 log2  n1+n2 log2n2```

多次验证都表明，预测的长度H与实际长度N非常接近。Halstead还给出了预测程序中包含错误的个数的公式如下：

- ```E=N log2 (n1+n2)/3000```

## 本章小结

1. `结构程序设计技术` 是进行详细设计的逻辑基础。
2. `人机界面` 设计必须重视。
3. `过程设计` 是详细设计阶段完成的主要工作。
4. 在开发有清楚的层次结构时可采用 `面向数据结构` 的设计方法完成设计过程设计。
5. 使用 `环形复杂度` 可以定量度量程序的复杂程度。

## 习题

### 习题 6.1

假设只有SEQUENCE和DO_WHILE两种控制结构，怎么利用它们完成IF_THEN_ELSE操作？

IF_THEN_ELSE

```plain
K = 1
DO WHILE （条件 .AND. K.EQ.1)
  程序块1
  K=K+1
END DO
DO WHILE （ (.NOT. 条件) .AND. K.EQ.1)
  程序块2
  K=K+1
END DO
```

### 习题 6.2

假设只有SEQUENCE和IF_THEN_ELSE两种控制结构，怎么利用它们完成DO_WHILE操作？

DO_WHILE

```plain
label: IF (条件) THEN
         程序块
         GOTO label
       ELSE
         程序块
       END IF
```

### 习题6.3

```plain
START
IF p THEN
  WHILE q DO
    f
  END DO
ELSE
  BLOCK
    g
    n
  END BLOCK
END IF
STOP
```

#### 画出流程图

![img 6.3 - 1](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589341818/notepad/2020-05-13_112834_nzs2ng.webp)

#### 画出盒图

![img 6.3 - 2](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589341818/notepad/2020-05-13_112945_ym5wxd.webp)

### 习题6.4

1. 为什么说图6.18是非结构化的？
2. 设计一个等价的结构化程序。

- a) 设计一个使用flag的程序；
- b) 设计一个不用flag的程序。

![img 6.4](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589341818/notepad/2020-05-13_113102_obva1a.webp)

#### 为什么非结构化

通常所说的结构化程序，每个代码块只有一个入口和一个出口。图示的程序的循环控制结构有两个出口，显然不符合狭义的结构程序的定义，因此是非结构化的程序。

#### 不使用flag

![img 6.4 - 2](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589341819/notepad/2020-05-13_113220_qmmmrr.webp)

![img 6.4 - 3](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589341819/notepad/2020-05-13_113240_qskugl.webp)

#### 使用flag

![img 6.4 - 4](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589341818/notepad/2020-05-13_113336_ukph0c.webp)

![img 6.4 - 5](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589341818/notepad/2020-05-13_113357_sbih1z.webp)

### 习题6.5

要求：

1. 画出流程图。
2. 程序是结构化的吗？说明理由。
3. 若此程序是非结构化，设计一个等价的结构化程序并画出流程图。
4. 此程序的功能是什么？它完成预定功能有什么隐含的前提条件吗？

```plain
LOOP:Set I to(START+FINISH)/2
  IF TABLE(I)=ITME goto FOUND
  IF TABLE(I)<ITME Set START to (I+1)
  IF TABLE(I)>TME Set FINSH to (I-1)
  IF (FINSH-START)>1 goto LOOP
  IF TABLE(START)=ITEM goto FOUND
  IF TABLE(FINSH)=ITEM goto FOUND
  Set FLAG to 0
  Goto DONE
FOUND：Set FLAG to 1
DONE：EXIT
```

#### 流程图

- 查找二分法
- 数据上界，中间和下界

- 该程序不是结构化的，结构化的程序只有一个入口和一个出口，而该程序的流程途中有两个出口。

![img 6.5](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589341817/notepad/2020-05-13_113653_rgz4zy.webp)

#### 结构化流程图

此程序有二分查找的功能，它完成预定功能的隐含前提条件是现有序列为从小到大顺序排好的有序序列。

![img 6.5 - 2](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589341818/notepad/2020-05-13_113747_lda4on.webp)

### 习题6.7 交易所手续费

- 总手续费等于 `基本手续费`，加上与交易中的每股价格和股数有关的 `附加手续费`。
- 如果交易金额少于1000元，则基本手续费为交易金额的8.4%；
- 如果交易总金额在1000元~10000元之间，则基本手续费为交易金额的5%，再加34元；
- 如果金额超过10000元，则基本手续费为交易金额的4%加上134元。
- 当每股售价低于14元时，
  - 附加手续费为基本手续费的5%，
  - 除非买进、卖出的股数不是100的倍数，在这种情况下附加手续费的9%。
- 当每股售价在14元到25元之间时，
  - 附加手续费为基本手续费的2%，
  - 除非交易的股数不是100的倍数，在这种情况下附加手续费的6%。
- 当每股售价超过25元时，
  - 如果交易的股数（即不是100的倍数），则附加手续费为基本手续费的4%，
  - 否则附加手续费为基本手续费的1%。

要求：
用判定表表示手续费的计算方法。
用判定数表示手续费的计算方法。

#### 用判定数表示手续费的计算方法

![img 6.7](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589341819/notepad/2020-05-13_113949_mz2zm5.webp)

#### 用判定表表示手续费的计算方法

![img 6.7 - 2](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589341851/notepad/2020-05-13_114027_yc7hw2.webp)

![img 6.7 - 3](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589341851/notepad/2020-05-13_114058_jaso8c.webp)

### 习题6.8

画出伪码程序的流图，
计算它的环形复杂度。你觉得这个程序的逻辑有什么问题吗？

```plain
C   EXAMPLE
LOOP: DO WHILE  X>0
        A=B+1
        IF A>10
          THEN X=A
        ELSE Y=Z
        END IF
        IF Y<5
          THEN PRINT X,Y
        ELSE IF Y=2
          THEN GOTO LOOP
        ELSE C=3
        END IF
        END IF
        G=H+R
      END DO
    IF F>0
      THEN PRINT G
    ELSE PRINT K
    END IF
STOP
```

![img 6.8](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589341851/notepad/2020-05-13_114620_aqqvkm.webp)

环形复杂度：

- 判断结点 ＋1=5 ＋1＝6

逻辑有问题，

- 当Z>0时，容易形成死循环；
- 条件Y<5包含条件Y=2。

### 习题6.9

![img 6.9](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589341851/notepad/2020-05-13_114740_dsunjf.webp)

#### 程序流程图

![img 6.9 - 2](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589341851/notepad/2020-05-13_114913_h7qigm.webp)

#### 盒图

![img 6.9 - 3](https://res.cloudinary.com/dfb5w2ccj/image/upload/v1589341851/notepad/2020-05-13_114859_knkkxk.webp)

输出格式

1. 每复制一行输入字符串后
2. 另起一行印出字符串中空格数
3. 最后印出文件中空格的总数
